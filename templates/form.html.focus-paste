<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GPX Waypoints Generator</title>
    <style>
        table { width: 50%; }
        th, td { padding: 5px; text-align: left; }
    </style>
    <script>
        // Function to handle pasting multiple coordinates into the latitude field
        function handleMultiplePaste(event, rowId) {
            // Get the pasted text from the clipboard
            const clipboardData = event.clipboardData || window.clipboardData;
            const pastedData = clipboardData.getData('Text').trim();

            // Split lines and process each line to extract lat/lon pairs
            const rows = pastedData.split('\n');
            let currentRowId = rowId;

            rows.forEach(row => {
                const coords = row.split('\t').map(coord => coord.replace(/[^\d.-]/g, '').trim());
                if (coords.length >= 2) {
                    // Populate the latitude and longitude fields
                    document.getElementById('lat-' + currentRowId).value = coords[0];
                    document.getElementById('lon-' + currentRowId).value = coords[1];

                    // Prepare for the next row
                    currentRowId++;
                    addRow(currentRowId);
                }
            });

            // Stop the default paste action
            event.preventDefault();

            // Set focus on the new empty latitude field
            document.getElementById('lat-' + currentRowId).focus();
        }

        // Function to add a new row dynamically
        function addRow(rowId) {
            const newRow = `
                <tr id="row-${rowId}">
                    <td><input type="text" id="lat-${rowId}" name="lat[${rowId}]" placeholder="Latitude" onpaste="handleMultiplePaste(event, ${rowId})"></td>
                    <td><input type="text" id="lon-${rowId}" name="lon[${rowId}]" placeholder="Longitude"></td>
                </tr>
            `;
            const table = document.getElementById('coordinate-table');
            table.insertAdjacentHTML('beforeend', newRow);
        }

        // Initial function call to set up the first input row
        document.addEventListener('DOMContentLoaded', () => addRow(0));
    </script>
</head>
<body>
    <h1>GPX Waypoints Generator</h1>
    <form action="/generate" method="post">
        <table id="coordinate-table">
            <thead>
                <tr>
                    <th>Latitude</th>
                    <th>Longitude</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <br>
        <input type="submit" value="Generate GPX">
    </form>
</body>
</html>